name: RSS Refresh (Backend Cron)

on:
  workflow_call:

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Trigger backend cron refresh
        run: |
          if [ -z "${CRON_URL}" ]; then
            echo "Missing secret: CRON_URL (example: https://your-backend.example.com/cron/refresh?limit=50)"
            exit 1
          fi
          echo "Calling ${CRON_URL}"
          curl -sS -X POST "${CRON_URL}" \
            -H "x-cron-secret: ${CRON_SECRET}" \
            -H "content-type: application/json" \
            --data "{}"
        env:
          CRON_URL: ${{ secrets.CRON_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
